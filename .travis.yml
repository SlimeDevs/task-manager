sudo: true
language: node_js
node_js:
- lts/*
cache:
- node_modules
services:
- mongodb
- docker
env:
  global:
  - secure: "V9N9IHFgqa36kqVO67lW3zMNvhE+KP/a/oqOZmwFTKWQbmHVRUkDSOEgZk9BWnRslFki1h+/V7OOP9zfVZR02cnj1omryEoMJW/OG8k5OYQMbw/oTQaVEVC6hpNOZr2NnlEOT0LBxy2bzI5GYzvM7H4iM1+Cro7MwwgQCMzKi2Y/5c0tKC55E9G7Or1xmnATJEUSGs4vG3IfuAFyS81CjvhhtqwB4SYO/ngU8LuLmGi/TPP7+m/DL46XYKKW06XDFD3XwUjo7JwuhXSy38UPnSdbalPbvElLuVeNnBgwAuGHnYkc25qttyUBAnkaSpIamXeziNUUCubFN8wD2NDgh4ORCKKLlYaSIwqoSZrD851RuhuzkJRBdxKwJWmo21QV1+F/6CYQDcH2EK1Ypu5A4QW7ICI8avl8tSdXGE7fplM4JRoUaeVTbi9wQXIOb2mbzl8hf586AGbCYtU3Hr5WCQFwxA581c/VyXAlRC9vxQYrKMPurQBbyuLwX4H+7GoM8fzdYHxN9+ylTb9YQbHv6du8KnsUp4oXJTcMy+YjpCs7KW4J9okJoElqURItZRCjGfky+Cl5MC++s49PQlYNT9fG8q8w8rbxkS//MTlrhmi3fvkOAur8dw6C89NCDMrbZXp1N+oX4ZSJZu2tAYvhzJFCz34v+sQtTFX6EHQ67LI="
  - secure: "Mz3G3GvoxFdVbAtnUCSZci9SWSgsvxYx4hphub409Yemw17OBFN77Bu9T/uvjn1qod6R2L1Wk7FylGBrTx6Kl6fp7+uRZt9cLZPB4zFL8M5D4rBjAewUu5yiI7IlqOHslTcALSagD4Q4zMHwtgFw/Z1p37lcaeSLVRPnLZRAtek4aQiBUUd0EPwIdJw6JXevPBJszUxWhZAdkgmIs8E3EX63fOiCACnn9+QHkSqNw0e6nuBHAT5DYqdyZ+2QfGKyQCXwBifBqWtXdXyHZxpGz1gyeEZPbt4jVRJlKRU2fvesztZ9Prit7efDMmA/o6Hivmd/uieG3SvraZIWKzg6hs5p9QOQ7fzrET0eblLD30q9x+OICoMkvjMF+srjvbDcSDYW1S8u1GkZyVRwGJSVwc1glw8NWG0ykmo0VlZZcWKG6eMcYPAWSydLVy0PLMN66GubbJyyDCWyIuNll/R0aVaY+JClht65MjUj0YyjlOruTx1NYABEk/7JxDHKKPYWChatY1LMc38hi3JQWotrvOQZAk2XMnWcdE7++XME5KboYP1AyAbleQKZ6++HX4je1wvbGqMvXV+yKkzFcRQSolYLwU1HpoGDcaV4c/hPm8bvVXr/qFkis7ysUDwWl1VKoyB+knrMJBJGBieuy2he3u0h/1bR9JXBLECuyOZmHnE="
  - secure: "kCuuyDwSXlNL+yDSm7R353Cun26bSDrMlf9y5yk0VB4HZ1fBiUMLdn0i/n9LR73y5WhKER+ceH1HHW7GkQvORO9Cwd7hOtgOQRnfaZeHJ8ttDfUuOGGY2LaxHO85lRkm/Y4c5oHPVEMRDbYMGbAxWsMmXYlo26WJutEdnYlI5zZ0LOqzxWdvktQ2DvFvkbRDSjOA4+rx5uVoVvgoL7kwhvGURWlsAO4Gamt+KTEJZRceYOTH4JZf/Mv4+qH4dkg4xUyDafz7UO2mYis6ktbwRk994mdedPC0shZZmXTyaX9jTfAWjpbnsPYRGmKlXq6NCAGL/2isWgmtAr4KDipAVFCZSxUzdqw7JOWaNz0/zyXNvBckridLhxaIUS/964XKb7tWcQj5PdMSlYVowRfulsYEh47bbLAFVneM5qtcT57SgRcdXbF0065yDcQKJFjoAeQANQp9h6AymgbRu27kk6k44A+EqycgXVK3BUnsX+hb1lgFQsDlk6GctmM6rp2TGwfPUjzymF5mDdUV2f7IH72UjYisCcK/FyQ3JFlxE66lAsBO1iqSsdDn/waJ3Q8NBFe3ZUiebtkvi3S0Z/pxaH44A05D9aUKO4zrGYYh60Z2nvHoVz66PmXbd0udpDi8Lj64evjaoAeE34haI4gDq9At4AjVOIDvDkKEWeu/2sE="
  - MONGODB_URI=mongodb://127.0.0.1:27017/todos
  - PORT=8080
install:
- npm install
script:
- npm test
before_deploy:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker build -t todo-app .
  - docker images
  - docker tag todo-app $DOCKER_USERNAME/todo-app
deploy:
  provider: script
  script: docker push $DOCKER_USERNAME/todo-app