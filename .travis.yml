sudo: true
language: node_js
node_js:
- lts/*
cache:
- node_modules
services:
- mongodb
- docker
env:
  global:
  - secure: HzqqF7OIiPF2Vf4onVGvVnXfFSDwYE+TzDOMI7nSYbqJLBSAcLRFKhRrLfz8u/85PntH6b71p6khKjpVvV+v0tGZiCOgNybjBI9T3zLA8+YQdFPbLaop/4JFJy5s693Hqpny+ntksmbQA8zWYFHidgy9duUM6UWdAEKa6IBGcaD3BXnV48klgvZ/qdPZZai4M+LZunX7yuvphOJJuw9IoseGbSDC/e2NF/Ouhp+ZQkzgSojeZSrKHz1y6lVZw4DKfi1Am2/zZwETtLOe4eOqXpSvLG6Ux9jA6g7BynniQGr3PpizL521++lzvyraWXSV3PwvXlsJm6zpVrWynXZ7nPCdplP6i9mQjd8CvKt7eu7M/hmOg3iG7fK9RtSi3v02WQ+mOgD3ex7rNSijN79joD38q1hH42Pa4lf2Ir81E8Xw7rf/kGhKEIJZQWHPKp95Az/w8/htb9EvFCly1ER/pls31/GAfHhqVmcXeLccJqD3e2UJdiYNDxgPV09B6pTSBhVjcPq+gyZxtOoGDx37rMxlfEwVUpjhiIckGS6c9h5J4s1hMQswYIJvp14mCK9YPyjGxq/l6d/hnt2efAMI7Ck8nvGqLdV3QPCx0W79JoW5ITedO85yWSxRjUC5l4P42lj5PWuKGBeufWJTgxtAlxvXKiDJKzJXtrOtn8N/6MQ=
  - secure: Ym096TmffdQL/WVjeR+D+81nTBBTiLlWKFTLv3Lnj5sTFCzuQlL10MFej/jnvCZr+dHj3TF7eFC2/g/3kTGlVow6G4cX4+sdXCh9oqp7wdV9jcZYIc+7Ou2bbE1sHWIjahYIPF76VSkjcVTVy7/Av8Wl34cq+DNWlevlYXIAuFH/Yl1yD4ToPsYfa5r05dAyXUhq6WcChv2hhMSqXBGq13ojpHk/hv2fW6A3I+K5aCgUiqP3iW4sohqSiciPw5QmV3n72wINXt87Bx1aBccorFigerb2a7SkXwlAiHQLATfV40RFR9zlS/mnJcm4Ss2fE/zybkn+Kx38YLtDP3eUOstO2r/yE8yMGvLsad+vfM8T20OuEsJUAWjbIet7CHIghR7t5gyyqj9jL6hB+nXxg7VreS/WxKkXFAQEYNT4+dIA/WCyXZuGZiXSSBUGwHV9I/G+bOfhkB7hXPZHMcRi10kJTmLhkBjyVb5a30e21ZYp4M5239uLekgUuQHeciyFMNMq1lj0b8mXAhGeMAdQcCTKES7ePNuL9Of+dV0VsS/DjwGiaUSyvCpmk5YEQEx7bmIIvRSq3IyMlpVnQUy0fGRjfgfTS8BxkvW8drbh2gVNtX4OCEcm+3fOZTxvx7JfZbX6RRgpcWwM2IQR0ATXfF5ZXTr6vXdNgAImcdlI5e8=
  - MONGODB_URI=mongodb://127.0.0.1:27017/todos
  - PORT=8080
install:
- npm install
script:
- npm test
before_deploy:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker build -t todo-app .
  - docker images
  - docker tag todo-app $DOCKER_USERNAME/todo-app
deploy:
  provider: script
  script: docker push $DOCKER_USERNAME/todo-app